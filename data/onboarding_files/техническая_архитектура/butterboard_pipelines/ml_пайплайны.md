# ML_пайплайны

## ML_пайплайны: Архитектура и Реализация RAG в Butterboard

**Дата:** 26 октября 2023 г.
**Версия:** 1.0
**Автор:** Дмитрий Петров, Инженер по машинообучению
**Владелец:** Антон Эйчаров, Head of HR

**1. Введение**

Этот документ описывает ML-пайплайны, лежащие в основе RAG (Retrieval-Augmented Generation) системы, используемой в Butterboard для обеспечения интеллектуального онбординга новых сотрудников.  RAG позволяет нашему ИИ-ассистенту не просто отвечать на вопросы, а использовать актуальную информацию из корпоративной базы знаний для предоставления релевантных и содержательных ответов.  Этот процесс критически важен для снижения нагрузки на HR-отдел, обеспечения быстрого доступа к информации для новых сотрудников и стандартизации процесса адаптации.  В данном разделе подробно рассматриваются этапы обработки данных, используемые модели, и инструменты, обеспечивающие эффективную работу системы.

**2. Общая Архитектура Пайплайна**

Пайплайн RAG в Butterboard состоит из следующих основных этапов:

1.  **Получение запроса пользователя:**  Пользователь (новый сотрудник) вводит свой вопрос в чат-бот Butterboard.
2.  **Предварительная обработка запроса:**  Запрос пользователя очищается от шума, приводит к нижнему регистру и выполняется токенизация.
3.  **Извлечение (Retrieval):**  На основе запроса пользователя, система использует векторную базу данных (Pinecone – текущий вариант) для поиска наиболее релевантных фрагментов информации из корпоративной базы знаний.
4.  **Генерация (Generation):**  Модель большой языковой модели (LLM – OpenAI GPT-4 Turbo) использует извлеченные фрагменты информации, а также исходный запрос пользователя, для генерации ответа.
5.  **Постобработка ответа:**  Сгенерированный ответ проходит фильтрацию и форматирование для обеспечения ясности и понятности.
6.  **Оценка ответа (Feedback Loop):**  Новый сотрудник оценивает качество ответа.  Эта обратная связь используется для улучшения работы модели и базы знаний.

**3. Детали реализации по этапам**

*   **3.1. Извлечение (Retrieval)**
    *   **Векторная база данных:** Pinecone.  Используется для хранения эмбеддингов (векторных представлений) документов и запросов.
    *   **Модель эмбеддингов:**  OpenAI Embeddings (text-embedding-ada-002).  Преобразует текст запросов и документов в векторные представления.
    *   **Методика индексации:**  Документы из базы знаний разбиваются на фрагменты (chunks) размером 512 токенов.  Каждый фрагмент преобразуется в эмбеддинг и сохраняется в Pinecone.
    *   **Поиск по сходству:**  При получении запроса от пользователя, он также преобразуется в эмбеддинг.  Pinecone выполняет поиск ближайших соседей (k-NN) для нахождения наиболее похожих фрагментов.  Текущая настройка: `k=5` (наиболее релевантные 5 фрагментов).
*   **3.2. Генерация (Generation)**
    *   **Модель LLM:** OpenAI GPT-4 Turbo.  Используется для генерации текстового ответа на основе запроса пользователя и извлеченных фрагментов.
    *   **Промпт:**  Специально разработанный промпт направляет GPT-4 Turbo использовать извлеченные фрагменты для ответа.  Пример промпта:
        ```
        "Вы – ИИ-ассистент Butterboard, помогающий новым сотрудникам. Используйте следующую информацию из корпоративной базы знаний, чтобы ответить на вопрос пользователя. Если информации недостаточно, сообщите об этом и предложите обратиться к HR.
        Фрагменты знаний:
        [Вставьте сюда извлеченные фрагменты из Pinecone]
        Вопрос пользователя: [Вставьте сюда вопрос пользователя]"
        ```
    *   **Параметры генерации:**  Температура 0.2, максимальная длина ответа 200 токенов.
*   **3.3. Постобработка ответа**
    *   **Фильтрация:**  Удаление нерелевантной информации или потенциально нежелательного контента.
    *   **Форматирование:**  Обеспечение читабельности ответа, использование заголовков, списков и т.д.
    *   **Оценка релевантности:**  Автоматическая оценка релевантности ответа на основе наличия в нем фрагментов из Pinecone.

**4. Интеграция и Инструменты**

*   **Backend:** Python (FastAPI) –  Обработка запросов, взаимодействие с Pinecone и OpenAI API.
*   **Frontend:**  React –  Интерфейс чат-бота Butterboard.
*   **База знаний:** Confluence –  Хранение и управление корпоративной базой знаний.
*   **Мониторинг:** Prometheus и Grafana –  Мониторинг производительности пайплайна, включая время ответа, использование ресурсов и количество ошибок.

**5.  Пример кода (Python - FastAPI)**

```python
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
import openai
import pinecone

app = FastAPI()

# Настройка OpenAI API
openai.api_key = "YOUR_OPENAI_API_KEY"

# Настройка Pinecone API
pinecone.init(api_key="YOUR_PINECONE_API_KEY", environment="YOUR_PINECONE_ENVIRONMENT")
index_name = "butterboard-onboarding-index"
index = pinecone.Index(index_name)

class Query(BaseModel):
    question: str

@app.post("/query")
async def query(query: Query):
    # 1. Извлечение
    results = index.query(vector_representation=openai.embeddings.create(query.question).values, top_k=5)

    # 2. Генерация
    prompt = f"Вы – ИИ-ассистент Butterboard, помогающий новым сотрудникам. Используйте следующие фрагменты знаний, чтобы ответить на вопрос пользователя. Если информации недостаточно, сообщите об этом и предложите обратиться к HR. \n Фрагменты знаний: {results.matches[0].metadata['text']}\n Вопрос пользователя: {query.question}"
    response = openai.chat.completions.create(model="gpt-4-turbo-preview", messages=[{"role": "user", "content": prompt}], temperature=0.2, max_tokens=200)
    answer = response.choices[0].message.content

    return {"answer": answer}
```

**6.  Будущие улучшения и планы**

*   **Обучение модели:**  Использование обратной связи от пользователей для улучшения качества ответов и расширения базы знаний.
*   **Улучшение поиска:**  Использование более сложных алгоритмов поиска по сходству.
*   **Добавление новых источников данных:**  Интеграция с другими корпоративными системами (например, система управления задачами).
*   **Персонализация:**  Более глубокая персонализация ответов на основе профиля сотрудника и его роли.  В данный момент Антон Титоренко (CMO, Head of JSON Parsing Department) и Олег Иванов (CEO, CTO, Head of Vibe Coding Department) обсуждают интеграцию с системой управления персоналом для получения более точных данных о сотрудниках.

**7. Контакты**

*   **Олег Иванов:** CEO, CTO, Head of Vibe Coding Department – o.ivanov@butterboard.online
*   **Антон Титоренко:** CEO, CMO, Head of JSON Parsing Department – a.titorenko@butterboard.online
*   **Антон Эйчаров:** Head of HR – hr@butterboard.online

**8. FAQ**

*   **Вопрос:** Как часто обновляется база знаний?
    *   **Ответ:** База знаний регулярно обновляется командой HR и специалистами по контенту.  Обычно обновления происходят раз в месяц, но могут быть более частыми в случае изменения процедур или политики компании.
*   **Вопрос:** Что делать, если ИИ-ассистент не смог ответить на вопрос?
    *   **Ответ:**  ИИ-ассистент сообщит об этом и предложит обратиться к HR-отделу.
*   **Вопрос:** Как можно добавить новый документ в базу знаний?
    *   **Ответ:**  Документы могут быть добавлены в Confluence командой HR.  Для этого необходимо предоставить документ в формате Markdown и краткое описание содержания.
*   **Вопрос:**  Поддерживаются ли другие языки?
    *   **Ответ:**  В настоящее время ИИ-ассистент поддерживает только английский язык.  В будущем планируется поддержка других языков.

---

Этот документ представляет собой отправную точку для дальнейшей разработки и улучшения ML-пайплайнов в Butterboard.  Постоянный мониторинг и анализ результатов позволят нам оптимизировать систему и обеспечить максимальную эффективность онбординга новых сотрудников.
Вот продолжение и расширение текста, с Markdown и кратким описанием содержания:

*   **Вопрос:** Поддерживаются ли другие языки?
    *   **Ответ:** В настоящее время ИИ-ассистент поддерживает только английский язык. В будущем планируется поддержка других языков.

---

Этот документ представляет собой отправную точку для дальнейшей разработки и улучшения ML-пайплайнов в Butterboard. Постоянный мониторинг и анализ результатов позволят нам оптимизировать систему и обеспечить максимальную эффективность онбординга новых сотрудников.

**Назначение документа:** Этот документ служит руководством для команды разработки и менеджеров Butterboard, описывающим текущее состояние и планы по развитию ИИ-ассистента, предназначенного для ускорения процесса онбординга новых сотрудников.

**Текущее состояние:**

*   **ИИ-ассистент:** В настоящее время функционирует как прототип, предоставляющий базовую поддержку в процессе онбординга.
*   **Поддерживаемый язык:**  ИИ-ассистент полностью поддерживает только английский язык.  В настоящее время отсутствует поддержка других языков.
*   **ML-пайплайны:**  Используются для автоматизации и оптимизации различных этапов онбординга, включая:
    *   Предоставление информации о компании и ее культуре.
    *   Назначение менторов и наставников.
    *   Автоматизация заполнения стандартных форм и документов.
    *   Отслеживание прогресса обучения и задач.
*   **Мониторинг и Анализ:**  Система собирает данные о взаимодействии сотрудников с ИИ-ассистентом, включая время, затраченное на выполнение задач, частоту обращений, и результаты опросов удовлетворенности.  Эти данные используются для выявления узких мест и возможностей для улучшения.

**Планы на будущее:**

*   **Расширение языковой поддержки:**  Первоочередной задачей является добавление поддержки других языков, начиная с наиболее востребованных (например, испанский, немецкий, французский).
*   **Улучшение качества ответов:**  Необходимо улучшить точность и релевантность ответов ИИ-ассистента, используя более сложные модели машинного обучения и расширяя базу знаний.
*   **Интеграция с другими системами:**  Планируется интеграция ИИ-ассистента с другими корпоративными системами, такими как HRIS и CRM, для обеспечения более комплексной поддержки онбординга.
*   **Персонализация:**  Разработка механизмов персонализации взаимодействия с ИИ-ассистентом, учитывающих роль сотрудника, его опыт и предпочтения.
*   **Оценка эффективности:**  Внедрение метрик для оценки эффективности ИИ-ассистента, таких как сокращение времени онбординга, повышение удовлетворенности новых сотрудников, и снижение нагрузки на HR-отдел.

**Следующие шаги:**

*   Проведение A/B-тестирования различных подходов к улучшению ИИ-ассистента.
*   Сбор обратной связи от новых сотрудников и HR-специалистов.
*   Разработка и внедрение новых функций и возможностей.

---

**Краткое описание содержания:**  Этот документ предоставляет обзор текущего состояния ИИ-ассистента в Butterboard, его целей, текущих возможностей, планов развития и дальнейших шагов по улучшению.  Он предназначен для координации усилий команды разработки и менеджеров, а также для обеспечения прозрачности и отслеживания прогресса в процессе улучшения системы онбординга.