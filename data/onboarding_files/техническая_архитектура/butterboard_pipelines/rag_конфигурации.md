# RAG_конфигурации

## RAG Конфигурации

**Версия:** 1.0
**Дата обновления:** 2023-10-27
**Автор:** Максим Петров, Senior AI Engineer
**Цель:** Этот документ описывает конфигурацию Retrieval-Augmented Generation (RAG) системы, используемой в Butterboard для обеспечения ответов ассистента онбординга, опираясь на корпоративную базу знаний.

**Введение**

RAG – это ключевая технология, позволяющая нашему ИИ-ассистенту предоставлять сотрудникам точную и актуальную информацию, необходимую для успешного онбординга. Без RAG, ассистент был бы ограничен только информацией, содержащейся в его базовой модели. RAG позволяет ему "просматривать" и извлекать информацию из нашей корпоративной базы знаний, а затем использовать эту информацию для формирования ответов. Это обеспечивает не только релевантность, но и актуальность данных, что критически важно для быстро меняющейся корпоративной среды.

**Архитектура RAG в Butterboard**

Система RAG в Butterboard состоит из следующих компонентов:

1. **Корпоративная База Знаний:**  Централизованное хранилище информации о компании, процессах, политиках, документах, лучших практиках и т.д. Данные хранятся в формате (в настоящее время в основном) Markdown и PDF, с последующей обработкой для индексации.
2. **Индекс:**  Преобразование документов из базы знаний в векторное представление. Для этого используется векторная база данных ChromaDB, подключенная к Elasticsearch.  Elasticsearch обеспечивает быстрый поиск по векторному представлению.
3. **Модель LLM (Large Language Model):**  Мы используем OpenAI GPT-4 для генерации ответов.  Используется API OpenAI.
4. **Модуль Извлечения (Retrieval):**  При получении запроса от сотрудника, этот модуль использует векторный поиск в ChromaDB, чтобы найти наиболее релевантные документы из базы знаний.
5. **Модуль Генерации (Generation):**  Получив запрос и релевантные документы, модуль генерирует ответ, используя модель GPT-4.  Этот модуль также включает в себя логику следования сценарию онбординга.

**Конфигурация Elasticsearch**

* **Версия:** 8.11.3
* **Тип данных:**  `document`
* **Mapping:**
    * `content`:  `text` -  Содержимое документа.  Используется для индексации и поиска.
    * `metadata`: `object` -  Метаданные документа (например, имя файла, дата создания, автор, роль, сценарий).
* **Index Name:** `butterboard_knowledge_base`
* **Settings:**
    * `index.number_of_shards`: 5
    * `index.number_of_replicas`: 1
    * `analysis.analyzer.default`: `standard`

**Конфигурация ChromaDB**

* **Версия:** 2.3.1
* **Collection Name:** `butterboard_rag`
* **Embedding Model:** OpenAI `text-embedding-ada-002` (API ключ: `sk-xxxxxxxxxxxxxxxxxxxxxxxxxxx`) -  Этот модель генерирует векторное представление текста.
* **Chunk Size:** 1024 токена -  Документы разбиваются на фрагменты размером 1024 токена для повышения эффективности поиска.
* **Similarity Metric:** `cosine` -  Используется для вычисления косинусного сходства между векторами запросов и документов.
* **Persistence:**  Данные ChromaDB регулярно сохраняются на диске для обеспечения отказоустойчивости.
* **Location:**  `./chromadb_db`

**Конфигурация OpenAI GPT-4**

* **Model:** `gpt-4`
* **Temperature:** 0.7 -  Контролирует случайность ответов.  Более высокие значения приводят к более креативным, но менее предсказуемым ответам.
* **Max Tokens:** 2048 -  Максимальное количество токенов в ответе.
* **Top P:** 1 -  Контролирует выбор наиболее вероятных токенов.
* **Frequency Penalty:** 0.0 -  Снижает вероятность повторения одних и тех же слов.
* **Presence Penalty:** 0.0 -  Снижает вероятность упоминания одних и тех же тем.

**Пример запроса к RAG (Python)**

```python
import openai
from chromadb.utils import embedding_functions

# Инициализация OpenAI API ключа
openai.api_key = "sk-xxxxxxxxxxxxxxxxxxxxxxxxxxx"

# Инициализация ChromaDB
client = chromadb.Client()
collection = client.get_collection(name="butterboard_rag")
embedding_function = embedding_functions.OpenAIEmbeddingFunction(model="text-embedding-ada-002")

# Запрос от сотрудника
query = "Как подать заявление на отпуск?"

# Извлечение релевантных документов из ChromaDB
results = collection.query(
    query_texts=[query],
    n_results=3
)

# Формирование подсказки для GPT-4
prompt = f"Ответ на вопрос сотрудника: {query}\n\nКонтекст:\n{results['documents'][0]}\n\nОтвет:"

# Генерация ответа с помощью GPT-4
response = openai.ChatCompletion.create(
    model="gpt-4",
    messages=[
        {"role": "user", "content": prompt}
    ],
    temperature=0.7,
    max_tokens=500
)

# Вывод ответа
print(response['choices'][0]['message']['content'])
```

**Мониторинг и Аналитика**

* **Отслеживание Оценки Ответов:**  Мы собираем обратную связь от сотрудников об оценке ответов ассистента.  Эта информация используется для постоянной оптимизации модели и базы знаний.
* **Анализ Вопросов:**  Анализируются наиболее часто задаваемые вопросы, чтобы выявить пробелы в базе знаний и улучшить индексацию.
* **Анализ Точности:**  Оценивается точность ответов ассистента, чтобы выявить случаи, когда требуется корректировка.

**Связанные Документы:**

* [Архитектура RAG системы](https://your-confluence-url/docs/RAG_Architecture)
* [Руководство по обслуживанию ChromaDB](https://your-confluence-url/docs/ChromaDB_Maintenance)
* [Руководство по обслуживанию OpenAI API](https://your-confluence-url/docs/OpenAI_API_Maintenance)

**Контактная Информация:**

* **Максим Петров (Senior AI Engineer):** max.petrov@butterboard.online
* **Антон Сидоров (DevOps Engineer):** anton.sidorov@butterboard.online

---

**Замечания:**

*  `your-confluence-url` необходимо заменить на фактическую ссылку на вашу Confluence.
*   API ключ OpenAI необходимо заменить на ваш реальный ключ.
*   Пример кода является упрощенным.  В реальной системе потребуются дополнительные механизмы обработки ошибок и логирования.
*   Конфигурация может быть изменена в зависимости от потребностей и доступных ресурсов.

Этот документ будет регулярно обновляться по мере развития RAG-системы в Butterboard.  Любые вопросы или предложения по улучшению следует направлять на Максима Петрового.
Вот расширенная версия текста с добавлением ссылки на вашу Confluence и более подробными пояснениями:

*   API ключ OpenAI необходимо заменить на ваш реальный ключ.  **Вы можете найти свой ключ и другие необходимые настройки в нашей Confluence-документации: [Вставьте здесь ссылку на вашу Confluence, например: https://yourcompany.atlassian.net/wiki/spaces/Butterboard/pages/edit/openai_config]**
*   Пример кода является упрощенным. В реальной системе потребуются дополнительные механизмы обработки ошибок, логирования и мониторинга.  **Более подробные рекомендации по обработке ошибок и логированию, а также примеры реализации, можно найти в разделе "Обработка ошибок и мониторинг" нашей Confluence-документации: [Вставьте здесь ссылку на соответствующий раздел Confluence, например: https://yourcompany.atlassian.net/wiki/spaces/Butterboard/pages/edit/error_handling_and_monitoring]**
*   Конфигурация (например, модели OpenAI, параметры запросов, настройки хранения векторов) может быть изменена в зависимости от потребностей и доступных ресурсов.  **Полный список доступных параметров конфигурации и их влияние на производительность системы можно изучить в разделе "Конфигурация RAG-системы" нашей Confluence-документации: [Вставьте здесь ссылку на раздел Confluence, например: https://yourcompany.atlassian.net/wiki/spaces/Butterboard/pages/edit/rag_configuration]**

Этот документ будет регулярно обновляться по мере развития RAG-системы в Butterboard.  Любые вопросы или предложения по улучшению следует направлять на Максима Петрового.  **Связаться с Максимом можно по электронной почте: maxim.petrov@yourcompany.com или через Slack в канале #butterboard-rag-dev.**

---

**Важно:** Замените `[Вставьте здесь ссылку на вашу Confluence...]` на фактическую ссылку на вашу Confluence-страницу.  Также, добавьте актуальный email Максима Петрового и канал Slack, если это уместно.
Вот продолжение и расширение текста, с учетом ваших пожеланий:

---

Этот документ представляет собой руководство по работе с RAG (Retrieval-Augmented Generation) системой, интегрированной в Butterboard.  RAG-система позволяет Butterboard использовать внешние источники знаний для генерации более точных и контекстуально релевантных ответов.  В текущей версии, RAG-система интегрирована с [**Вставьте здесь ссылку на вашу Confluence...**] и использует модель [Укажите используемую языковую модель, например, GPT-4, Gemini, Llama 2].  Она предназначена для улучшения качества ответов на вопросы пользователей, касающихся [Укажите область применения RAG-системы, например, внутренних документов компании, базы знаний, документации продукта].

**Как работает RAG в Butterboard:**

1.  **Получение вопроса:** Пользователь задает вопрос через интерфейс Butterboard.
2.  **Извлечение релевантной информации:** RAG-система использует заданный вопрос для поиска релевантных фрагментов информации из внешних источников, указанных в [Укажите источник данных, например, база данных документов, векторная база данных].
3.  **Генерация ответа:** RAG-система объединяет исходный вопрос с извлеченной информацией и использует языковую модель для генерации ответа.

**Текущие возможности и ограничения:**

*   **Поддерживаемые источники:** В настоящее время RAG-система поддерживает следующие источники: [Перечислите источники данных, например, Confluence, Google Drive, SharePoint].
*   **Формат извлекаемых данных:**  Система способна извлекать данные из следующих форматов: [Перечислите форматы, например, Markdown, HTML, PDF].
*   **Ограничения:**  В текущей версии RAG-система может испытывать трудности с пониманием сложных вопросов, требующих глубокого анализа контекста. Также, точность ответов напрямую зависит от качества и полноты информации, содержащейся в используемых источниках.  Могут возникать случаи, когда система выдает неточную или устаревшую информацию.

**Развитие и будущие улучшения:**

RAG-система в Butterboard будет регулярно обновляться по мере развития и совершенствования.  Мы планируем внести следующие улучшения:

*   **Поддержка новых источников данных:**  Расширение списка поддерживаемых источников информации.
*   **Улучшение алгоритмов извлечения:**  Оптимизация поиска релевантной информации для повышения точности и скорости.
*   **Добавление возможностей контекстного понимания:**  Улучшение способности системы понимать сложные вопросы и извлекать необходимый контекст.
*   **Интеграция с другими инструментами Butterboard:**  Более тесная интеграция с другими модулями и функциями платформы.

Любые вопросы или предложения по улучшению следует направлять на Максима Петрового.  **Связаться с Максимом можно по электронной почте: maxim.petrov@yourcompany.com или через Slack в канале #butterboard-rag-dev.**  Также, для обсуждения технических вопросов и предоставления обратной связи, рекомендуется использовать канал #butterboard-dev.  Мы ценим ваше участие в развитии RAG-системы Butterboard!

---

**Примечание:**  Пожалуйста, замените все placeholder-ы (например, `[Вставьте здесь ссылку на вашу Confluence...]`, `[Укажите используемую языковую модель...]`, `[Укажите область применения RAG-системы...]`) на фактические данные.  Укажите актуальный email Максима Петрового и канал Slack.  Добавьте конкретные детали о поддерживаемых источниках и форматах данных.